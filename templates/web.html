<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7632web</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        background-color: #f0f0f0;
      }

      .sidebar {
        width: 200px;
        background-color: #333;
        color: white;
        height: 100vh;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      .sidebar ul {
        list-style-type: none;
        padding: 0;
      }

      .sidebar ul li {
        margin: 20px 0;
      }

      .sidebar ul li button {
        width: 100%;
        padding: 10px;
        background-color: #444;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-align: left;
        transition: background-color 0.3s;
      }

      .sidebar ul li button:hover {
        background-color: #555;
      }

      .main-content {
        flex-grow: 1;
        padding: 0;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin: 20px;
        border-radius: 8px;
        overflow: hidden;
      }

      .main-content h1 {
        margin-top: 0;
        color: #333;
        padding: 20px;
        background-color: #f4f4f4;
        border-bottom: 1px solid #ccc;
      }

      .data-box {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .tab {
        overflow: hidden;
        border-bottom: 1px solid #ccc;
        background-color: #007bff;
        margin-bottom: 0;
      }

      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 20px;
        transition: 0.3s;
        font-size: 16px;
        color: white;
      }

      .tab button:hover {
        background-color: #0056b3;
      }

      .tab button.active {
        background-color: #0056b3;
      }

      .tabcontent {
        display: none;
        padding: 20px;
        border-top: none;
        background-color: #fff;
      }

      textarea {
        width: 100%;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      button {
        padding: 4px 20px;
        border: none;
        border-radius: 4px;
        background-color: #28a745;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #218838;
      }

      .file-list {
        list-style-type: none;
        padding: 0;
      }

      .file-list li {
        margin: 10px 0;
        padding: 10px;
        background-color: #f4f4f4;
        border: 1px solid #ccc;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      .file-list li a {
        text-decoration: none;
        color: #007bff;
        font-weight: bold;
      }

      .file-list li a:hover {
        text-decoration: underline;
      }

      .file-list li:hover {
        background-color: #e9e9e9;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      table,
      th,
      td {
        border: 1px solid #ccc;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #f4f4f4;
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <ul>
        <li><button id="Panel">Panel</button></li>
        <li><button id="Cameras">Cameras</button></li>
        <li><button id="Files">Files</button></li>
      </ul>
    </div>

    <div class="main-content">
      <h1 id="welcome-message">Welcome Using this tools</h1>
      <div id="content" class="data-box">
        <!-- 這裡會顯示來自後端的資料 -->
      </div>
    </div>

    <script>
      /*const mockData = {
                      option1: { title: '??賊?? 1', description: '?????舫?賊?? 1 ???鞈????' },
                      option2: { title: '??賊?? 2', description: '?????舫?賊?? 2 ???鞈????' },
                      option3: { title: '??賊?? 3', description: '?????舫?賊?? 3 ???鞈????' },
                      option4: { title: '??賊?? 4', description: '?????舫?賊?? 4 ???鞈????' },
                  };*/

      // 設置事件監聽器
      document.getElementById("Panel").addEventListener("click", function () {
        loadContent("Panel");
      });

      document.getElementById("Cameras").addEventListener("click", function () {
        loadContent("Cameras");
      });

      document.getElementById("Files").addEventListener("click", function () {
        loadContent("Files");
      });
      let updateInterval;
      // 根據選項載入內容
      function loadContent(option) {
        document.getElementById("welcome-message").style.display = "none";
        if (option === "Panel") {
          document.getElementById("content").innerHTML = `
                          <div class="tab">
                              <button class="tablinks" onclick="openTab(event, 'info')">INFO</button>
                              <button class="tablinks" onclick="openTab(event, 'control')">CONTROL</button>
                          </div>
                          <div id="info" class="tabcontent">
                              <h3>Jetson Orin Nano 資訊</h3>
                              <div id="info-data">載入中...</div>
                          </div>
                          <div id ="control" class="tabcontent">
                              <h3>控制面板</h3>
                                <button onclick="sendCommand('shutdown')">關機</button>
                                <button onclick="sendCommand('reboot')">重啟</button>
                                <button onclick="sendCommand('restart_service')">重啟服務</button>
                                <button onclick="sendCommand('start_service')">啟動服務</button>
                                <button onclick="sendCommand('stop_service')">停止服務</button>
                            </div>
                      `;
          openTab(null, "info");
          fetchPanelData();
          if (updateInterval) {
            clearInterval(updateInterval);
          }
          updateInterval = setInterval(fetchPanelData, 500); // 每5秒更新一次
        } else if (option === "Cameras") {
          document.getElementById("content").innerHTML = `
                                      <div class="tab">
                              <button class="tablinks" onclick="openTab(event, 'Camera1')">Camera 1</button>
                              <button class="tablinks" onclick="openTab(event, 'Camera2')">Camera 2</button>
                              <button class="tablinks" onclick="openTab(event, 'Camera3')">Camera 3</button>
                          </div>
                          <div id="Camera1" class="tabcontent">
                              <h3>Camera 1</h3>
                              <img src="/video_feed/camera1" alt="Camera 1">
                          </div>
                          <div id="Camera2" class="tabcontent">
                              <h3>Camera 2</h3>
                              <img src="/video_feed/camera2" alt="Camera 2">
                          </div>
                          <div id="Camera3" class="tabcontent">
                              <h3>Camera 3</h3>
                              <img src="/video_feed/camera3" alt="Camera 3">
                          </div>
                      `;
          openTab(null, "Camera1"); // 預設打開 Camera1
        } else if (option === "Files") {
          document.getElementById("content").innerHTML = `
                          <div class="tab">
                              <button class="tablinks" onclick="openTab(event, 'doc')">doc</button>
                              <button class="tablinks" onclick="openTab(event, 'edition')">edition</button>
                          </div>
                          <div id="doc" class="tabcontent">
                              <h2>檔案上傳/下載</h2>
                              <form id="uploadForm" enctype="multipart/form-data">
                                  <input type="file" id="fileInput" name="file">
                                  <button type="button" onclick="uploadFile()">上傳</button>
                              </form>
                              <button onclick="downloadFile('main.py')">下載 script.py</button>
                              <button onclick="downloadFile('main.sh')">下載 script.sh</button>
                              <h2>web 目錄檔案</h2>
                              <ul id="fileList" class="file-list"></ul>
                          </div>
                          <div id="edition" class="tabcontent">
                              <h2>編輯檔案內容</h2>
                              <select id="fileSelect" onchange="fetchFileContent()">
                                  <option value="main.py">main.py</option>
                                  <option value="main.sh">main.sh</option>
                              </select>
                              <textarea id="fileContent" rows="10" cols="50"></textarea>
                              <button type="button" onclick="saveFile()">存檔</button>
                          </div>
                      `;
          openTab(null, "doc"); // 預設打開 doc
          fetchWebDirectoryFiles();
        } else {
          document.getElementById("content").innerHTML = `<p>資料未找到</p>`;
        }
      }

      function uploadFile() {
        const formData = new FormData(document.getElementById("uploadForm"));
        fetch("/files", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert("檔案上傳成功");
              fetchWebDirectoryFiles(); // 上傳成功後刷新文件列表
            } else {
              alert(`錯誤: ${data.message}`);
            }
          })
          .catch((error) => {
            alert("檔案上傳失敗");
          });
      }
      function downloadFile(filename) {
        window.location.href = `/files?filename=${encodeURIComponent(filename)}`;
      }


      function saveFile() {
        const filename = document.getElementById("fileSelect").value;
        const content = document.getElementById("fileContent").value;
        fetch("/save", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ filename: filename, content: content }),
        })
          .then((response) => response.json())
          .then((data) => {
            alert("檔案儲存成功");
          })
          .catch((error) => {
            alert("檔案儲存失敗");
          });
      }
      function fetchWebDirectoryFiles(path = "") {
        fetch(`/files?path=${path}`)
          .then((response) => response.json())
          .then((items) => {
            const fileList = document.getElementById("fileList");
            fileList.innerHTML = "";
            items.forEach((item) => {
              const listItem = document.createElement("li");
              if (item.isDirectory) {
                const link = document.createElement("a");
                link.href = "#" ;
                link.textContent = item.name;
                link.style.color = "red"; // 根目錄下的目錄換色
                link.onclick = () => {
                  fetchWebDirectoryFiles(`${path}/${item.name}`);
                  return false; // 防止默認行為
                };
                listItem.appendChild(link);
              } else {
                const link = document.createElement("a");
                link.href = "#";
                link.textContent = item.name;
                link.onclick = () => {
                  downloadFile(`${path}/${item.name}`);
                  return false; // 防止默認行為
                };
                listItem.appendChild(link);
              }
              fileList.appendChild(listItem);
            });
            if (path) {
              const listItem = document.createElement("li");
              const link = document.createElement("a");
              link.href = "#";
              link.textContent = "返回上層";
              link.onclick = () => {
                fetchWebDirectoryFiles(path.split("/").slice(0, -1).join("/"));
                return false; // 防止默認行為
              };
              fileList.insertBefore(listItem, fileList.firstChild);
              listItem.appendChild(link);
            }
          })
          .catch((error) => {
            alert("無法獲取 web 目錄檔案");
          });
      }
      function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        if (evt) {
          evt.currentTarget.className += " active";
        }
        document.getElementById(tabName).style.display = "block";
      }
      function fetchPanelData() {
        fetch(`/panel`)
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              const infoData = document.getElementById("info-data");
              infoData.innerHTML = generateTable(data.data);
            } else {
              document.getElementById(
                `info-data`
              ).innerText = `error: ${data.message}`;
            }
          })
          .catch((error) => {
            document.getElementById(`info-data`).innerText = `error: ${error}`;
          });
      }
      function sendCommand(command) {
        fetch("/panel", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ command: command }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert(`error: ${data.message}`);
            } else {
              alert(`success: ${data.message}`);
            }
          })
          .catch((error) => {
            alert(`error: ${error}`);
          });
      }
      function generateTable(data) {
        const units = {
          temp: "°C",
          power: "mW",
          cpu: "%",
          gpu: "%",
          // 添加更多需要的單位
        };

        let table = "<table>";
        for (let key in data) {
          let unit = "";
          // 使用部分匹配來添加單位
          for (let unitKey in units) {
            if (key.toLowerCase().includes(unitKey)) {
              unit = ` ${units[unitKey]}`;
              break;
            }
          }
          table += `<tr><th>${key}</th><td>${data[key]}${unit}</td></tr>`;
        }
        table += "</table>";
        return table;
      }
    </script>
  </body>
</html>
